---
phase: 06-polish-distribution
plan: 03
type: execute
wave: 4
depends_on: ["06-02", "06-05"]
files_modified:
  - components/ui/BottomSheet.tsx
  - components/ui/EmptyState.tsx
  - app/(tabs)/index.tsx
  - app/group/[id].tsx
  - app/group/[id]/balance/[memberId].tsx
  - components/groups/AddMemberModal.tsx
autonomous: true

must_haves:
  truths:
    - "Create group flow uses a bottom sheet instead of a modal"
    - "Add member flow uses a bottom sheet instead of a modal"
    - "Empty groups list shows Taglish microcopy with emoji and guidance"
    - "Empty expenses list shows Taglish microcopy with peso-themed guidance"
    - "All settled balances show celebratory Taglish microcopy"
    - "Peso sign is used throughout the app consistently"
  artifacts:
    - path: "components/ui/BottomSheet.tsx"
      provides: "Themed wrapper around @gorhom/bottom-sheet"
      contains: "BottomSheetModal"
    - path: "components/ui/EmptyState.tsx"
      provides: "Reusable empty state with emoji, headline, subtext"
      contains: "EmptyState"
  key_links:
    - from: "app/(tabs)/index.tsx"
      to: "components/ui/BottomSheet.tsx"
      via: "Create group bottom sheet replaces Modal"
      pattern: "BottomSheetModal"
    - from: "components/groups/AddMemberModal.tsx"
      to: "components/ui/BottomSheet.tsx"
      via: "Add member bottom sheet replaces Modal"
      pattern: "BottomSheetModal"
    - from: "app/(tabs)/index.tsx"
      to: "components/ui/EmptyState.tsx"
      via: "Groups empty state with Taglish"
      pattern: "EmptyState"
---

<objective>
Convert action modals to bottom sheets for a more native feel, create reusable empty state components with Taglish microcopy, and ensure peso sign and casual Filipino tone are used throughout the app.

Purpose: Bottom sheets feel more native on mobile than centered modals. Friendly Taglish empty states guide users and add personality. Consistent peso sign reinforces the Filipino finance context.
Output: Bottom sheet wrapper, empty state component, all screens updated with Taglish microcopy and bottom sheet patterns.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-distribution/06-RESEARCH.md
@.planning/phases/06-polish-distribution/06-02-SUMMARY.md
@.planning/phases/06-polish-distribution/06-05-SUMMARY.md
@app/(tabs)/index.tsx
@app/group/[id].tsx
@app/group/[id]/balance/[memberId].tsx
@components/groups/AddMemberModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create bottom sheet wrapper and empty state component</name>
  <files>
    components/ui/BottomSheet.tsx
    components/ui/EmptyState.tsx
  </files>
  <action>
1. Create `components/ui/BottomSheet.tsx`:
   - Import `BottomSheetModal, BottomSheetView, BottomSheetTextInput, BottomSheetBackdrop` from `@gorhom/bottom-sheet`
   - Create `AppBottomSheet` component that wraps `BottomSheetModal` with app theming:
     - `backgroundStyle={{ backgroundColor: colors.backgroundCard }}`
     - `handleIndicatorStyle={{ backgroundColor: colors.textTertiary }}`
     - Default `snapPoints={['50%']}` (overridable via props)
     - Custom backdrop: `BottomSheetBackdrop` with `disappearsOnIndex={-1}` and `appearsOnIndex={0}`, `opacity={0.6}`
   - Export `AppBottomSheet` (the themed modal wrapper)
   - Export `BottomSheetTextInput` (re-export for use in bottom sheet forms -- regular TextInput doesn't work inside bottom sheets)
   - Export a `useBottomSheet` helper: returns `{ ref, open, close }` where ref is `useRef<BottomSheetModal>(null)`, open calls `ref.current?.present()`, close calls `ref.current?.dismiss()`
   - Props interface: `{ snapPoints?: string[], children: ReactNode, onDismiss?: () => void }`

2. Create `components/ui/EmptyState.tsx`:
   - Simple presentational component with props: `{ emoji: string, headline: string, subtext: string }`
   - Layout: centered vertically in available space
   - Emoji: rendered as large text (fontSize 48)
   - Headline: `variant="bodyMedium"` `color="textPrimary"`, centered
   - Subtext: `variant="body"` `color="textSecondary"`, centered, max width 280
   - Spacing: `spacing[3]` gap between emoji and headline, `spacing[2]` between headline and subtext
   - Export as named export `EmptyState`
     </action>
     <verify>
   - `npx tsc --noEmit` passes
   - Both components export correctly
     </verify>
     <done>
   - BottomSheet.tsx exports AppBottomSheet, BottomSheetTextInput, useBottomSheet
   - EmptyState.tsx exports EmptyState component with emoji, headline, subtext props
     </done>
     </task>

<task type="auto">
  <name>Task 2: Convert modals to bottom sheets, add Taglish microcopy, and audit peso sign</name>
  <files>
    app/(tabs)/index.tsx
    app/group/[id].tsx
    app/group/[id]/balance/[memberId].tsx
    components/groups/AddMemberModal.tsx
  </files>
  <action>
1. Update `app/(tabs)/index.tsx`:
   a) Replace the create-group `Modal` with `AppBottomSheet`:
      - Use `useBottomSheet()` hook for ref/open/close
      - Replace `<Modal visible={showCreate}>` with `<AppBottomSheet ref={sheetRef} snapPoints={['45%']} onDismiss={resetForm}>`
      - Replace `TextInput` inside the sheet with `BottomSheetTextInput` (required for keyboard interaction inside bottom sheets)
      - Keep all create group logic (handleCreateGroup, validation, etc.)
      - Remove `showCreate` state, use `sheetRef.open()` / `sheetRef.close()` instead
      - On "+" press: call `sheetRef.open()` instead of `setShowCreate(true)`
      - On create success: call `sheetRef.close()`

b) Replace the `ListEmptyComponent` with Taglish empty state: - Use `<EmptyState emoji={"ðŸª™"} headline="Wala pa kay group!" subtext="Tap + to create one, or ask a friend for an invite code" />`

2. Update `app/group/[id].tsx`:
   a) Replace empty states with Taglish microcopy:
   - Balances "All settled up" -> `<EmptyState emoji={"âœ…"} headline="All settled!" subtext="Walang utang-utangan. Nice!" />`
   - Expenses "No expenses yet" -> `<EmptyState emoji={"ðŸ§¾"} headline="No expenses yet" subtext="Mag-add ng expense para ma-track kung sino may utang" />`
   - Members empty state (just you): Not needed since creator is always a member

   b) Audit peso sign usage: ensure `formatPeso` from expense-utils is used consistently (it already returns formatted peso amounts). The balance display already uses "P" prefix via formatPeso -- update any hardcoded "P" to use the peso sign "â‚±" if not already handled by formatPeso.

3. Update `app/group/[id]/balance/[memberId].tsx`:
   - Audit all currency displays for peso sign consistency
   - Replace any hardcoded 'P' prefix with the proper peso sign 'â‚±'
   - Check if `formatPeso` utility is used; if the file formats amounts manually (e.g., `'P' + amount` or template literals with 'P'), replace with 'â‚±' or call `formatPeso`
   - If the file uses a local formatting function, update it to use 'â‚±' instead of 'P'
   - This addresses the UX-08 gap: balance drill-down must show 'â‚±' not 'P'

4. Update `components/groups/AddMemberModal.tsx`:
   - Convert from `Modal` to `AppBottomSheet`
   - Change the component name to `AddMemberSheet` (update export and import in group/[id].tsx)
   - Replace `visible` prop with `ref` pattern using `useBottomSheet()`
   - Parent (`group/[id].tsx`) controls sheet via ref: `addMemberRef.current?.present()` instead of `setShowAddMember(true)`
   - Replace internal `TextInput` with `BottomSheetTextInput`
   - Keep all phone validation and add member logic unchanged
   - Update snapPoints to `['55%']` to accommodate phone input + keyboard

5. Update `app/group/[id].tsx` to use the renamed `AddMemberSheet` with ref pattern:
   - Replace `<AddMemberModal visible={showAddMember} onClose={...} />` with `<AddMemberSheet ref={addMemberRef} groupId={id!} onAdded={fetchData} />`
   - Remove `showAddMember` state, use `addMemberRef` instead
     </action>
     <verify>
   - `npx tsc --noEmit` passes
   - Create group: tapping "+" opens bottom sheet (not modal), can type group name, create works
   - Add member: tapping "Add Member" opens bottom sheet, phone input works
   - Empty groups list shows Taglish microcopy with coin emoji
   - Empty expenses shows Taglish microcopy with receipt emoji
   - All settled balances shows checkmark emoji with Taglish
   - Balance drill-down screen shows 'â‚±' not 'P' for all amounts
     </verify>
     <done>
   - Create group uses bottom sheet instead of centered modal
   - Add member uses bottom sheet instead of centered modal
   - All empty states display Taglish microcopy with relevant emoji
   - Peso sign 'â‚±' used consistently throughout, including balance drill-down
   - Bottom sheets have drag-to-dismiss, themed background, backdrop dimming
     </done>
     </task>

</tasks>

<verification>
1. Create group bottom sheet opens from bottom, dismisses on swipe down
2. Add member bottom sheet opens from bottom with keyboard support
3. Groups list empty state shows Taglish: "Wala ka pang group!"
4. Expenses empty state shows Taglish: "No expenses yet" with Filipino subtext
5. Balances settled state shows: "All settled!" with "Walang utang-utangan"
6. Balance drill-down screen shows 'â‚±' (not 'P') for all amounts
7. `npx tsc --noEmit` passes
8. No regressions in create group or add member flows
</verification>

<success_criteria>

- Zero centered modals for action flows (all converted to bottom sheets)
- All empty states use EmptyState component with emoji + Taglish microcopy
- Bottom sheets themed to match dark app aesthetic
- Keyboard input works correctly inside bottom sheets
- Peso sign 'â‚±' visible in ALL currency contexts including balance drill-down
  </success_criteria>

<output>
After completion, create `.planning/phases/06-polish-distribution/06-03-SUMMARY.md`
</output>
