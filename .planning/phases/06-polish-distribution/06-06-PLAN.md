---
phase: 06-polish-distribution
plan: "06"
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/network-context.tsx
  - app/group/[id].tsx
  - app/(tabs)/index.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Yellow offline banner does not appear on iOS simulator startup when network is actually available"
    - "Pull-to-refresh triggers data reload on groups list even when content is shorter than the screen"
    - "Pull-to-refresh triggers data reload on group detail even when content is shorter than the screen"
  artifacts:
    - path: "lib/network-context.tsx"
      provides: "Network online/offline state with startup false-positive guard"
      contains: "netInfo.type === \"unknown\""
    - path: "app/(tabs)/index.tsx"
      provides: "Groups list FlatList with always-bounceable pull-to-refresh"
      contains: "alwaysBounceVertical"
    - path: "app/group/[id].tsx"
      provides: "Group detail ScrollView with always-bounceable pull-to-refresh"
      contains: "alwaysBounceVertical"
  key_links:
    - from: "lib/network-context.tsx"
      to: "app/(tabs)/index.tsx"
      via: "useNetwork() isOnline"
      pattern: "useNetwork"
    - from: "app/(tabs)/index.tsx"
      to: "AnimatedRefreshControl"
      via: "FlatList refreshControl prop"
      pattern: "refreshControl"
    - from: "app/group/[id].tsx"
      to: "AnimatedRefreshControl"
      via: "ScrollView refreshControl prop"
      pattern: "refreshControl"
---

<objective>
Close two UAT gaps identified in Phase 6 testing: a false-positive offline banner on iOS simulator startup, and pull-to-refresh not triggering when screen content is shorter than the viewport.

Purpose: Both issues surfaced during UAT and undermine the polish goals of Phase 6. The offline banner falsely signals a broken connection; the non-working pull-to-refresh removes a key data-refresh path.
Output: Two targeted one-line fixes across three files.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/06-polish-distribution/06-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix offline banner false positive on iOS simulator startup</name>
  <files>lib/network-context.tsx</files>
  <action>
    The current guard is:

      const isOnline = netInfo.isConnected !== false;

    This correctly treats null as online (avoiding the flash when isConnected has not yet resolved), but it does not guard against the case where netInfo.type is "unknown" and isConnected is transiently false during iOS simulator startup before the network type is determined. In that window, isConnected === false passes the guard and the banner fires.

    Replace the single-line derivation with a two-condition check:

      const isOnline =
        netInfo.type === "unknown" || netInfo.isConnected !== false;

    When the network type is still unknown (startup probe in progress), treat the device as online. Once the type resolves (e.g., "wifi", "cellular", "none"), fall back to the existing isConnected !== false logic.

    Do not change any other code in this file.
  </action>
  <verify>
    Cold-launch the app in the iOS simulator. The yellow offline banner must NOT appear during startup when the device has a network connection. Let the app fully load and confirm the banner stays hidden. Then toggle the simulator to airplane mode (Features > Network > Toggle Network Condition to "Offline" or use Network Link Conditioner) and confirm the banner DOES appear.
  </verify>
  <done>Yellow offline banner is absent on startup with network available; it appears only when the device is actually offline.</done>
</task>

<task type="auto">
  <name>Task 2: Fix pull-to-refresh on short-content screens</name>
  <files>app/(tabs)/index.tsx, app/group/[id].tsx</files>
  <action>
    On iOS, when a FlatList or ScrollView has content shorter than the viewport, it does not bounce by default and the RefreshControl gesture never fires. The fix is alwaysBounceVertical={true}, which forces the bounce physics regardless of content height.

    In app/(tabs)/index.tsx, add alwaysBounceVertical={true} to the FlatList at line 373. The prop sits alongside the existing refreshControl prop:

      <FlatList
        data={groups}
        renderItem={renderItem}
        keyExtractor={keyExtractor}
        contentContainerStyle={styles.list}
        alwaysBounceVertical={true}
        ListEmptyComponent={ListEmpty}
        refreshControl={
          <AnimatedRefreshControl
            refreshing={refreshing}
            onRefresh={handleRefresh}
          />
        }
      />

    In app/group/[id].tsx, add alwaysBounceVertical={true} to the ScrollView at line 364. The prop sits alongside the existing refreshControl prop:

      <ScrollView
        style={styles.scrollView}
        contentContainerStyle={styles.scrollContent}
        showsVerticalScrollIndicator={false}
        alwaysBounceVertical={true}
        refreshControl={
          <AnimatedRefreshControl
            refreshing={refreshing}
            onRefresh={handleRefresh}
          />
        }
      >

    Do not change any other props or logic in either file.
  </action>
  <verify>
    1. Navigate to the Groups tab with only one or zero groups (short list). Pull down from the top. The spinner must appear and release must trigger handleRefresh (groups list reloads).
    2. Navigate into any group detail. If the group has few expenses/members such that the content does not fill the screen, pull down from the top. The spinner must appear and release must trigger handleRefresh.
    3. Confirm both screens still work normally when content is taller than the screen (standard pull-to-refresh behavior unchanged).
  </verify>
  <done>Pull-to-refresh fires on both screens regardless of content height on iOS.</done>
</task>

</tasks>

<verification>
After both tasks:

1. Cold-launch simulator — no offline banner on startup.
2. Enable airplane mode — offline banner appears.
3. Disable airplane mode — offline banner disappears.
4. Groups tab with short list — pull-to-refresh works.
5. Group detail with short content — pull-to-refresh works.
</verification>

<success_criteria>
- lib/network-context.tsx: isOnline derivation guards against netInfo.type === "unknown"
- app/(tabs)/index.tsx FlatList: alwaysBounceVertical={true} present
- app/group/[id].tsx ScrollView: alwaysBounceVertical={true} present
- Both UAT failures resolved with no regressions to existing behavior
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-distribution/06-06-SUMMARY.md`
</output>
