---
phase: 06-polish-distribution
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - eas.json
  - app.json
autonomous: false

user_setup:
  - service: apple-developer
    why: "iOS TestFlight distribution requires Apple Developer account"
    env_vars: []
    dashboard_config:
      - task: "Ensure Apple Developer Program membership is active"
        location: "developer.apple.com/account"
  - service: expo-eas
    why: "EAS Build requires Expo account linked to project"
    env_vars: []
    dashboard_config:
      - task: "Log in to EAS CLI with expo account"
        location: "Run: eas login"

must_haves:
  truths:
    - "eas.json exists with preview profile configured for internal distribution"
    - "app.json has iOS bundleIdentifier and Android package configured"
    - "EAS build can be triggered from CLI for both platforms"
  artifacts:
    - path: "eas.json"
      provides: "EAS Build configuration with preview profile"
      contains: "internal"
    - path: "app.json"
      provides: "App config with platform identifiers"
      contains: "bundleIdentifier"
  key_links:
    - from: "eas.json"
      to: "app.json"
      via: "EAS reads app.json for build config"
      pattern: "preview"
---

<objective>
Configure EAS Build for internal distribution so testers can install the app via TestFlight (iOS) and direct APK/AAB download (Android).

Purpose: This is the distribution mechanism that gets the app into the hands of 5-10 testers. EAS internal distribution is the standard Expo approach for pre-release testing.
Output: eas.json with preview profile, app.json updated with platform identifiers, verified build configuration.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-distribution/06-RESEARCH.md
@app.json
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure EAS Build for internal distribution</name>
  <files>
    eas.json
    app.json
  </files>
  <action>
1. Update `app.json` to add required platform identifiers:
   - Add to `expo.ios`: `"bundleIdentifier": "com.hatian.app"`
   - Add to `expo.android`: `"package": "com.hatian.app"`
   - Keep all existing config (icon, splash, plugins, etc.) unchanged

2. Create `eas.json` at project root:
   ```json
   {
     "cli": {
       "version": ">= 16.0.0",
       "appVersionSource": "remote"
     },
     "build": {
       "development": {
         "developmentClient": true,
         "distribution": "internal"
       },
       "preview": {
         "distribution": "internal",
         "ios": {
           "simulator": false
         }
       },
       "production": {}
     },
     "submit": {
       "production": {
         "ios": {
           "appleId": "",
           "ascAppId": "",
           "appleTeamId": ""
         }
       }
     }
   }
   ```
   - The `preview` profile is the key one: `"distribution": "internal"` enables TestFlight for iOS and direct install for Android
   - Leave `submit.production` fields empty as placeholders (user fills in later)

3. Install EAS CLI globally if not already:
   ```bash
   npm list -g eas-cli 2>/dev/null || npm install -g eas-cli
   ```

4. Verify configuration:
   ```bash
   cd /Users/julianernestcamello/drawing-board/money-split-app && npx eas build:configure --platform all 2>&1 || true
   ```
   (This validates eas.json structure -- may prompt for login which is expected)
  </action>
  <verify>
    - `eas.json` exists with preview profile containing `"distribution": "internal"`
    - `app.json` has `bundleIdentifier` and `package` fields
    - `npx tsc --noEmit` still passes (no TS impact)
  </verify>
  <done>
    - eas.json created with development, preview, and production build profiles
    - preview profile configured for internal distribution
    - app.json updated with iOS bundleIdentifier and Android package
    - EAS CLI available for build commands
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify EAS build readiness</name>
  <what-built>EAS Build configuration for internal distribution (TestFlight + Android direct install). The eas.json and app.json are configured but a build has not been triggered yet.</what-built>
  <how-to-verify>
    1. Run `eas login` if not already authenticated
    2. Run `eas build --platform android --profile preview --no-wait` to trigger an Android preview build (faster, no Apple credentials needed)
    3. Check build status at the URL output by the command
    4. If build succeeds, you can install the APK on an Android device or share the install link
    5. For iOS: Run `eas build --platform ios --profile preview --no-wait` (requires Apple Developer credentials -- will prompt)
    6. Note: First builds take 10-20 minutes. The `--no-wait` flag lets the build run in EAS cloud while you continue.
  </how-to-verify>
  <resume-signal>Type "approved" if build configuration is correct, or describe any issues with the build</resume-signal>
</task>

</tasks>

<verification>
1. eas.json exists at project root with correct structure
2. app.json has bundleIdentifier and package
3. `eas build:configure` validates without structural errors
4. Preview profile uses internal distribution
</verification>

<success_criteria>
- eas.json created with preview profile for internal distribution
- app.json updated with platform-specific identifiers
- Build can be triggered from CLI (actual build success depends on credentials)
- Testers can receive builds via TestFlight (iOS) or direct download (Android)
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-distribution/06-04-SUMMARY.md`
</output>
