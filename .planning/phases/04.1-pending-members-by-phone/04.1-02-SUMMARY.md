---
phase: "04.1"
plan: "02"
subsystem: "frontend"
tags: ["pending-members", "group-detail", "phone-input", "modal", "unified-member-type"]
dependency-graph:
  requires: ["04.1-01"]
  provides: ["GroupMember type", "fetchAllMembers function", "AddMemberModal component", "pending member display in group detail"]
  affects: ["04.1-03"]
tech-stack:
  added: []
  patterns: ["unified member interface with isPending flag", "bottom-sheet modal for phone input", "parallel fetch for real + pending members"]
key-files:
  created:
    - lib/group-members.ts
    - components/groups/AddMemberModal.tsx
  modified:
    - app/group/[id].tsx
    - lib/database.types.ts
decisions:
  - id: "04.1-02-d1"
    decision: "Hash symbol (#) as pending member avatar placeholder"
    rationale: "Simple, recognizable indicator that distinguishes pending from real members without requiring emoji or image"
metrics:
  duration: "~3min"
  completed: "2026-02-18"
---

# Phase 4.1 Plan 02: Frontend Integration for Pending Members Summary

Unified GroupMember type with fetchAllMembers, phone input modal calling add_pending_member RPC, and group detail screen updated to display pending members with visual indicators.

## What Was Done

### Task 1: Create unified GroupMember type and fetch function
- Created `lib/group-members.ts` with `GroupMember` interface (id, display_name, avatar_url, isPending, phone_number)
- Exported `fetchAllMembers(groupId)` that queries `group_members` + `pending_members` in parallel via Promise.all
- Exported `formatPhoneDisplay(e164)` for converting "+639171234567" to "+63 917 123 4567"
- Exported `isValidPHPhone(digits)` for validating 10-digit PH mobile numbers
- Updated `lib/database.types.ts` with `pending_members` table type and `add_pending_member` RPC type (was missing from plan 04.1-01 which only created migrations)

### Task 2: Add member modal and update group detail screen
- Created `components/groups/AddMemberModal.tsx` with bottom-sheet style modal matching app dark theme
- Modal has +63 prefix phone input (same pattern as auth phone.tsx), validation, and add_pending_member RPC call
- Error handling for "already a member" and "already pending" cases with inline error display
- Updated `app/group/[id].tsx` to use `fetchAllMembers` instead of direct group_members query
- Pending members render with # avatar, formatted phone as name, "Pending" badge (yellow), "Pending signup" subtitle
- Real members render unchanged (avatar, display_name, creator badge)
- Added "Add Member" secondary button next to "Invite Friends"
- Member count badge reflects total (real + pending)
- AddMemberModal wired: triggers fetchData refresh on successful add

## Task Commits

| Task | Name | Commit | Key Files |
|------|------|--------|-----------|
| 1 | Create unified GroupMember type and fetch function | 23443f3 | lib/group-members.ts, lib/database.types.ts |
| 2 | Add member modal and update group detail screen | 22677bb | components/groups/AddMemberModal.tsx, app/group/[id].tsx |

## Decisions Made

| ID | Decision | Rationale |
|----|----------|-----------|
| 04.1-02-d1 | Hash symbol (#) as pending member avatar placeholder | Simple, recognizable indicator that distinguishes pending from real members without requiring emoji or image |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Updated database.types.ts with pending_members table and add_pending_member RPC**
- **Found during:** Task 1
- **Issue:** Plan 04.1-01 created SQL migrations but did not update the TypeScript database types file. TypeScript compilation failed because `supabase.from("pending_members")` and `supabase.rpc("add_pending_member")` were not recognized.
- **Fix:** Added `pending_members` table definition, `add_pending_member` RPC definition, and updated `expense_splits` to include nullable `user_id`, `pending_member_id` fields in database.types.ts
- **Files modified:** lib/database.types.ts
- **Commit:** 23443f3

## Next Phase Readiness

Plan 04.1-03 (pending member integration in expense creation) can proceed. The `GroupMember` type and `fetchAllMembers` function are ready for reuse in payer selection and split member selection. The `AddMemberModal` pattern can be referenced for any future phone-input UI.

## Self-Check: PASSED
