---
phase: 01-foundation-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/_layout.tsx
  - app/(tabs)/_layout.tsx
  - app/(tabs)/index.tsx
  - app/(tabs)/add.tsx
  - app/(tabs)/profile.tsx
  - lib/supabase.ts
  - lib/database.types.ts
  - supabase/config.toml
  - supabase/migrations/00001_initial_schema.sql
  - .env.example
  - .gitignore
  - tsconfig.json
  - package.json
  - app.json
autonomous: true
user_setup:
  - service: supabase
    why: "Database backend with auth and RLS"
    env_vars:
      - name: EXPO_PUBLIC_SUPABASE_URL
        source: "Supabase Dashboard -> Project Settings -> API -> Project URL"
      - name: EXPO_PUBLIC_SUPABASE_ANON_KEY
        source: "Supabase Dashboard -> Project Settings -> API -> anon/public key"
    dashboard_config:
      - task: "Create a new Supabase project"
        location: "https://supabase.com/dashboard -> New Project"
      - task: "Enable Phone Auth provider"
        location: "Supabase Dashboard -> Authentication -> Providers -> Phone"

must_haves:
  truths:
    - "Expo app boots without errors on iOS simulator or Android emulator"
    - "Supabase migration file contains all 5 tables (users, groups, group_members, expenses, expense_splits) with RLS enabled and policies defined"
    - "Supabase client initializes with expo-sqlite localStorage and typed Database generic"
    - "Expo Router file-based routing is set up with (tabs) group containing 3 routes"
  artifacts:
    - path: "supabase/migrations/00001_initial_schema.sql"
      provides: "Full database schema with RLS policies and indexes"
      contains: "enable row level security"
    - path: "lib/supabase.ts"
      provides: "Typed Supabase client singleton"
      contains: "createClient<Database>"
    - path: "app/(tabs)/_layout.tsx"
      provides: "Tab navigation layout with 3 tabs"
      contains: "Tabs"
    - path: ".env.example"
      provides: "Environment variable template"
      contains: "EXPO_PUBLIC_SUPABASE_URL"
  key_links:
    - from: "lib/supabase.ts"
      to: "lib/database.types.ts"
      via: "import type { Database }"
      pattern: "import.*Database.*database\\.types"
    - from: "lib/supabase.ts"
      to: ".env"
      via: "process.env.EXPO_PUBLIC_SUPABASE_URL"
      pattern: "process\\.env\\.EXPO_PUBLIC_SUPABASE"
---

<objective>
Scaffold the Expo project with TypeScript, set up Supabase CLI with the full database schema migration (5 tables + RLS policies + indexes), initialize the Supabase JS client with expo-sqlite localStorage, and configure Expo Router with a (tabs) group for the 3-tab navigation structure.

Purpose: Establishes the project skeleton and backend infrastructure that all subsequent phases build upon. Without this foundation, no features can be implemented.

Output: A bootable Expo app with Supabase integration ready for schema deployment, typed database client, and file-based routing structure.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Expo project and install dependencies</name>
  <files>
    package.json
    app.json
    tsconfig.json
    .gitignore
    .env.example
  </files>
  <action>
    1. Create the Expo project using `npx create-expo-app@latest . --template default` (run from the project root — the project directory already exists as a git repo, so scaffold in-place). If create-expo-app complains about existing files, use a temp directory and move files.

    2. Install core dependencies:
       ```bash
       npx expo install @supabase/supabase-js expo-sqlite
       ```

    3. Install font dependencies:
       ```bash
       npx expo install @expo-google-fonts/plus-jakarta-sans expo-font
       ```

    4. Install Supabase CLI as dev dependency:
       ```bash
       npm install -D supabase
       ```

    5. Initialize Supabase:
       ```bash
       npx supabase init
       ```

    6. Create `.env.example` with:
       ```
       EXPO_PUBLIC_SUPABASE_URL=https://your-project-ref.supabase.co
       EXPO_PUBLIC_SUPABASE_ANON_KEY=your-anon-key-here
       ```

    7. Add `.env` to `.gitignore` (keep `.env.example` tracked).

    8. Verify `tsconfig.json` has path alias configured:
       ```json
       {
         "compilerOptions": {
           "paths": { "@/*": ["./*"] }
         }
       }
       ```
       The default Expo template should include this. If not, add it.

    9. Update `app.json`: set name to "HatianApp", slug to "hatian-app", scheme to "hatian" (for deep linking in Phase 3).
  </action>
  <verify>
    Run `npx expo start` — app should launch Metro bundler without errors.
    Run `npx supabase --version` — CLI should be available.
    Verify `.env.example` exists with both EXPO_PUBLIC variables.
    Verify `tsconfig.json` has `@/*` path alias.
  </verify>
  <done>
    Expo project boots with Metro bundler. Supabase CLI is initialized. Environment template exists. TypeScript path aliases are configured.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create database migration with full schema and RLS</name>
  <files>
    supabase/migrations/00001_initial_schema.sql
  </files>
  <action>
    Create the migration file at `supabase/migrations/00001_initial_schema.sql` with the complete database schema. Use the exact SQL from the research document (Pattern 4), which includes:

    **Tables (5):**
    1. `public.users` — id (uuid, refs auth.users), phone_number (unique), display_name, avatar_url, created_at
    2. `public.groups` — id (uuid), name, invite_code (unique, auto-generated 8-char), created_by (refs users), created_at
    3. `public.group_members` — id (uuid), group_id (refs groups, cascade), user_id (refs users, cascade), joined_at; unique(group_id, user_id)
    4. `public.expenses` — id (uuid), group_id (refs groups, cascade), description, amount (numeric(10,2), check > 0 and <= 999999), paid_by (refs users), split_type (check in 'equal','custom'), created_by (refs users), created_at
    5. `public.expense_splits` — id (uuid), expense_id (refs expenses, cascade), user_id (refs users), amount (numeric(10,2), check >= 0); unique(expense_id, user_id)

    **RLS Policies:**
    - users: select own profile, update own profile, insert own profile, view co-members' profiles
    - groups: select groups where user is member, insert groups as authenticated
    - group_members: select members of user's groups, insert self as member
    - expenses: select expenses in user's groups, insert expenses in user's groups
    - expense_splits: select splits in user's groups, insert splits in user's groups

    **Indexes (4):**
    - idx_group_members_user_id
    - idx_group_members_group_id
    - idx_expenses_group_id
    - idx_expense_splits_expense_id

    **Important:** Use `(select auth.uid())` wrapped in a subquery (not bare `auth.uid()`) in all policies — this is a Supabase best practice for performance.
  </action>
  <verify>
    Review the migration file to confirm:
    - All 5 tables are defined with correct column types and constraints
    - All tables have `enable row level security`
    - All RLS policies use `(select auth.uid())` pattern
    - All 4 performance indexes are present
    - `amount` constraints are correct: expenses > 0 and <= 999999, splits >= 0
  </verify>
  <done>
    Migration file exists with all 5 tables, RLS policies for every table, and performance indexes. Schema matches PROJECT.md data model specification.
  </done>
</task>

<task type="auto">
  <name>Task 3: Set up Supabase client and Expo Router tab structure</name>
  <files>
    lib/supabase.ts
    lib/database.types.ts
    app/_layout.tsx
    app/(tabs)/_layout.tsx
    app/(tabs)/index.tsx
    app/(tabs)/add.tsx
    app/(tabs)/profile.tsx
  </files>
  <action>
    1. Create `lib/database.types.ts` — a placeholder type file that will be replaced by `supabase gen types` once the database is deployed. For now, define a minimal Database type interface matching the schema:
       ```typescript
       export type Database = {
         public: {
           Tables: {
             users: { Row: { id: string; phone_number: string; display_name: string | null; avatar_url: string | null; created_at: string }; Insert: { id: string; phone_number: string; display_name?: string | null; avatar_url?: string | null }; Update: { display_name?: string | null; avatar_url?: string | null } };
             groups: { Row: { id: string; name: string; invite_code: string; created_by: string; created_at: string }; Insert: { name: string; created_by: string }; Update: { name?: string } };
             group_members: { Row: { id: string; group_id: string; user_id: string; joined_at: string }; Insert: { group_id: string; user_id: string }; Update: {} };
             expenses: { Row: { id: string; group_id: string; description: string; amount: number; paid_by: string; split_type: string; created_by: string; created_at: string }; Insert: { group_id: string; description: string; amount: number; paid_by: string; split_type: string; created_by: string }; Update: {} };
             expense_splits: { Row: { id: string; expense_id: string; user_id: string; amount: number }; Insert: { expense_id: string; user_id: string; amount: number }; Update: {} };
           };
         };
       };
       ```
       Format this cleanly with proper line breaks. This is a placeholder — note in a comment that it should be regenerated with `npx supabase gen types typescript --local > lib/database.types.ts` after deploying the schema.

    2. Create `lib/supabase.ts` following the research Pattern 2:
       - Import `expo-sqlite/localStorage/install` polyfill FIRST
       - Create typed client with `createClient<Database>`
       - Use `process.env.EXPO_PUBLIC_SUPABASE_URL` and `process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY`
       - Configure auth with `storage: localStorage`, `persistSession: true`, `detectSessionInUrl: false`
       - Add AppState listener for auto-refresh token management

    3. Replace the default `app/_layout.tsx` with the root layout from research:
       - Import and configure Plus Jakarta Sans fonts (400, 500, 600, 700, 800 weights) using `useFonts`
       - Use `SplashScreen.preventAutoHideAsync()` to prevent white flash
       - Hide splash screen when fonts are loaded
       - Render `<StatusBar style="light" />` for dark theme
       - Render `<Stack screenOptions={{ headerShown: false, contentStyle: { backgroundColor: '#0D0D0D' } }}>` — use hardcoded color for now since theme tokens come in Plan 02
       - Include a `<Stack.Screen name="(tabs)" />` entry

    4. Create `app/(tabs)/_layout.tsx` with basic Expo Router `<Tabs>` navigator:
       - 3 tabs: index (Groups), add (Add), profile (Profile)
       - Use `screenOptions` to set dark theme colors: `tabBarStyle: { backgroundColor: '#141414', borderTopColor: '#222222' }`, `tabBarActiveTintColor: '#9FE870'`, `tabBarInactiveTintColor: '#666666'`
       - Use Ionicons from `@expo/vector-icons` for tab icons: `people-outline` for Groups, `add-circle` for Add, `person-outline` for Profile
       - NOTE: This is a basic Tabs setup. The custom FAB-style center button will be implemented in Plan 02 when the design system is available.

    5. Create placeholder screens for each tab:
       - `app/(tabs)/index.tsx` — Groups screen with dark background and centered text "Groups" using hardcoded styles
       - `app/(tabs)/add.tsx` — Add screen with dark background and centered text "Add Expense"
       - `app/(tabs)/profile.tsx` — Profile screen with dark background and centered text "Profile"
       - Each screen: `View` with `flex: 1, backgroundColor: '#0D0D0D', justifyContent: 'center', alignItems: 'center'` and white `Text`
  </action>
  <verify>
    Run `npx expo start` and verify:
    - App launches without errors
    - Dark background is visible (no white flash)
    - Bottom tab bar appears with 3 tabs
    - Tapping each tab navigates to the correct placeholder screen
    - Status bar shows light (white) text
    Run `npx tsc --noEmit` — no TypeScript errors
  </verify>
  <done>
    Typed Supabase client exists and initializes correctly. Expo Router tab structure works with 3 tabs. App renders with dark theme basics. Font loading prevents white flash on startup.
  </done>
</task>

</tasks>

<verification>
1. `npx expo start` — Metro bundler launches without errors
2. App renders on simulator/emulator with dark background, no white flash
3. Bottom tabs show Groups, Add, Profile — all navigable
4. `supabase/migrations/00001_initial_schema.sql` contains 5 CREATE TABLE statements, 5 ENABLE RLS statements, and 4 CREATE INDEX statements
5. `lib/supabase.ts` imports `expo-sqlite/localStorage/install` and creates a typed client
6. `npx tsc --noEmit` passes with no errors
</verification>

<success_criteria>
- Expo app boots and renders dark-themed placeholder screens
- Tab navigation works with 3 tabs (Groups, Add, Profile)
- Database migration file is complete with all tables, RLS policies, and indexes
- Supabase client is initialized with correct auth configuration
- TypeScript compiles without errors
- Environment variable template exists
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-01-SUMMARY.md`
</output>
