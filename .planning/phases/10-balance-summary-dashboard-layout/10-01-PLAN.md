---
phase: 10-balance-summary-dashboard-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(tabs)/index.tsx
autonomous: true

must_haves:
  truths:
    - "User sees a single net balance number at the top of the home screen that sums across all groups"
    - "Balance is color-coded: green when others owe the user, red when the user owes others, neutral when settled up"
    - "Balance header has large, prominent typography (moneyLarge 48px ExtraBold) visually distinct from the rest"
    - "Home screen is clearly divided into visual sections (balance, activity placeholder, groups) with distinct separation"
    - "FAB for quick-add expense continues to work"
    - "Create group + button remains functional"
    - "Balance header is hidden when user has no groups (avoids misleading 'settled up' for new users)"
  artifacts:
    - path: "app/(tabs)/index.tsx"
      provides: "Dashboard-style home screen with balance summary, activity placeholder, and sectioned layout"
      contains: "netBalance"
      min_lines: 50
  key_links:
    - from: "app/(tabs)/index.tsx"
      to: "lib/balance-utils.ts"
      via: "formatBalanceColor and formatBalanceSummary for color-coded balance display"
      pattern: "formatBalanceColor\\(netBalance\\)"
    - from: "app/(tabs)/index.tsx"
      to: "lib/expense-utils.ts"
      via: "formatPeso for peso formatting in balance header"
      pattern: "formatPeso\\(Math\\.abs\\(netBalance\\)\\)"
    - from: "app/(tabs)/index.tsx"
      to: "theme/typography.ts"
      via: "moneyLarge variant for hero balance number"
      pattern: "variant=\"moneyLarge\""
    - from: "netBalance useMemo"
      to: "groupBalances state"
      via: "sum of existing Map values"
      pattern: "groupBalances\\.values\\(\\)"
---

<objective>
Transform the home screen from a flat groups list into a sectioned dashboard with a prominent balance summary header, activity placeholder, and clear visual hierarchy.

Purpose: User opens the app and immediately sees their financial position across all groups -- the primary value proposition of the app -- in a polished dashboard layout that feels like a real fintech product rather than a plain list.

Output: Modified `app/(tabs)/index.tsx` with balance summary header (moneyLarge, color-coded), activity placeholder section (for Phase 11), sectioned layout with visual dividers, and updated screen header.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-balance-summary-dashboard-layout/10-RESEARCH.md
@app/(tabs)/index.tsx
@lib/balance-utils.ts
@lib/expense-utils.ts
@theme/typography.ts
@theme/colors.ts
@theme/spacing.ts
@components/ui/Text.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add balance summary header with net balance computation and color-coding</name>
  <files>app/(tabs)/index.tsx</files>
  <action>
Add the balance summary header to the home screen. This is the core feature for BAL-01, BAL-02, BAL-03, and VIS-02.

**1. Compute net balance from existing state (add after groupBalances state, ~line 97):**

```typescript
const netBalance = useMemo(() => {
  let total = 0;
  for (const centavos of groupBalances.values()) {
    total += centavos;
  }
  return total;
}, [groupBalances]);
```

This sums the existing `groupBalances` Map (centavos). No new API calls needed -- the data is already fetched by `fetchBalances`.

**2. Create BalanceSummaryHeader as an inline function component (above the main component or as a helper inside the file):**

- Show a centered column with:
  - Small label: "Overall Balance" using `variant="caption"` `color="textSecondary"`
  - Hero balance number using `variant="moneyLarge"` `color={formatBalanceColor(netBalance)}`
  - Display format: Just the amount without +/- prefix, e.g. "P1,234.56" or "P0.00". Use `formatPeso(Math.abs(netBalance))` and prepend "P".
  - Descriptor line below: `formatBalanceSummary(netBalance, formatPeso)` using `variant="body"` `color="textSecondary"`
- Container padding: `paddingVertical: spacing[6]` (24px), `paddingHorizontal: spacing[6]`, centered with `alignItems: "center"`
- Total header height should be compact (~120px including padding)
- CRITICAL: If `groups.length === 0`, return `null` from the balance summary. A new user with no groups should NOT see "P0.00 / All settled up" -- it's misleading. Only show the balance when there are groups.

**3. Update the existing screen header:**

- Change the "Groups" title text from `variant="h1"` to `variant="h2"` and change the text from "Groups" to "Home"
- Keep the "+" button exactly as-is (it triggers `openCreateSheet()` for the create group bottom sheet)
- This gives the balance header visual dominance (48px moneyLarge vs 24px h2)

**4. Color-coding specifics (using existing utilities):**

- `formatBalanceColor(netBalance)` returns: `"accent"` (green/#9FE870) for positive (owed money), `"error"` (red/#E85454) for negative (owes money), `"textSecondary"` (gray/#AAAAAA) for zero
- These color tokens map directly to the `<Text color={...}>` prop -- no custom color logic needed

**Important: Do NOT add a loading state to the balance header.** The existing stale-while-revalidate pattern (fetches on focus, updates when done) is correct. Adding a loading indicator would cause flicker.
  </action>
  <verify>
Run `npx expo export --platform ios 2>&1 | tail -20` to verify no build errors. Visually verify:
1. The file has a `netBalance` useMemo that sums `groupBalances.values()`
2. A BalanceSummaryHeader component exists with `variant="moneyLarge"`
3. `formatBalanceColor` is used for color-coding
4. `formatBalanceSummary` is used for the descriptor text
5. Balance header returns null when `groups.length === 0`
6. The "+" create group button still exists and calls `openCreateSheet()`
  </verify>
  <done>
Balance summary header displays the net balance across all groups in moneyLarge (48px ExtraBold) typography, color-coded green/red/neutral using existing balance-utils. Hidden when user has no groups. Screen header updated to "Home" with h2 variant. Create group button preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add dashboard section layout with activity placeholder and visual dividers</name>
  <files>app/(tabs)/index.tsx</files>
  <action>
Structure the home screen into a clear sectioned dashboard layout. This covers VIS-01 (sectioned layout) and the Phase 11 activity placeholder.

**1. Wire the ListHeaderComponent into the existing SectionList:**

Add `ListHeaderComponent` to the SectionList (around line 593). The header should include:
- The BalanceSummaryHeader from Task 1 (passing `netBalance` and `hasGroups: groups.length > 0`)
- A horizontal divider line
- The Activity placeholder section
- Another horizontal divider line

Create a `DashboardHeader` component that composes these:

```typescript
const DashboardHeader = useCallback(() => (
  <View>
    <BalanceSummaryHeader netBalance={netBalance} hasGroups={groups.length > 0} />

    {groups.length > 0 && (
      <>
        <View style={styles.sectionDivider} />

        <View style={styles.activitySection}>
          <Text variant="label" color="textSecondary">
            Recent Activity
          </Text>
          <Text variant="caption" color="textTertiary" style={styles.activityPlaceholder}>
            Coming soon
          </Text>
        </View>

        <View style={styles.sectionDivider} />
      </>
    )}
  </View>
), [netBalance, groups.length]);
```

Pass it to SectionList: `ListHeaderComponent={<DashboardHeader />}`

**2. Add styles for section separation:**

```typescript
sectionDivider: {
  height: 1,
  backgroundColor: colors.borderSubtle,
  marginHorizontal: spacing[6],
},
activitySection: {
  paddingHorizontal: spacing[6],
  paddingVertical: spacing[5],
  gap: spacing[2],
},
activityPlaceholder: {
  fontStyle: "italic" as const,
},
```

**3. Update existing section headers for typography hierarchy:**

The existing `renderSectionHeader` uses `variant="caption"`. Change it to `variant="label"` to use the uppercase 13px Medium style. This matches the "Recent Activity" label styling and creates consistent section labeling across the dashboard.

**4. Ensure the activity placeholder and dividers only show when groups exist.** If `groups.length === 0`, the ListHeaderComponent should render nothing (or just the empty area -- the EmptyState for groups handles messaging).

**5. Verify total header height stays under 220px:** Balance header (~120px) + divider (1px) + activity placeholder (~60px) + divider (1px) = ~182px. This leaves groups visible on first render without excessive scrolling.

**6. Do NOT move the page header ("Home" + "+" button) into the ListHeaderComponent.** Keep it as a fixed element above the SectionList (current position). This ensures the create group button is always visible even when scrolled.

**7. Keep all existing functionality intact:**
- Pull-to-refresh via AnimatedRefreshControl
- Skeleton loader when loading with no cached data
- SectionList `sections` with `as any` cast (known TS issue)
- Invite cards, group cards, and all their handlers
- Bottom sheet for create group
  </action>
  <verify>
Run `npx expo export --platform ios 2>&1 | tail -20` to verify no build errors. Visually verify:
1. SectionList has `ListHeaderComponent` prop set
2. DashboardHeader contains BalanceSummaryHeader + dividers + activity placeholder
3. Activity placeholder shows "Recent Activity" label + "Coming soon" text
4. Section dividers use `colors.borderSubtle` with `marginHorizontal: spacing[6]`
5. `renderSectionHeader` uses `variant="label"` for consistent typography
6. Activity section hidden when `groups.length === 0`
7. Pull-to-refresh, skeleton loader, and bottom sheet all preserved
  </verify>
  <done>
Home screen has a clear sectioned dashboard layout: balance summary header at top, horizontal divider, activity placeholder ("Recent Activity" / "Coming soon"), another divider, then the existing invite and group sections. Typography hierarchy established with moneyLarge (hero) > h2 (page title) > label (section labels) > bodyMedium (card titles) > caption (secondary info). All existing functionality preserved.
  </done>
</task>

</tasks>

<verification>
After both tasks complete, verify the full Phase 10 success criteria:

1. **BAL-01**: `netBalance` useMemo exists, summing `groupBalances.values()`. Displayed via `formatPeso(Math.abs(netBalance))` in moneyLarge variant.
2. **BAL-02**: `formatBalanceColor(netBalance)` used as `color` prop on balance Text -- green for positive, red for negative, gray for zero.
3. **BAL-03**: Balance uses `variant="moneyLarge"` (48px ExtraBold) -- visually dominant on the screen.
4. **VIS-01**: ListHeaderComponent creates sections: balance -> divider -> activity placeholder -> divider -> invites/groups. Clear visual separation.
5. **VIS-02**: Typography hierarchy: moneyLarge (48px) > h2 (24px) > label (13px uppercase) > bodyMedium (15px) > caption (13px). Varied sizes and weights guide the eye.
6. **QAC-01**: FAB navigates to add expense with group picker (pre-completed, not modified).

Run: `npx expo export --platform ios 2>&1 | tail -5` -- should show "Export successful"
Grep: `variant="moneyLarge"` exists in index.tsx
Grep: `netBalance` exists in index.tsx
Grep: `ListHeaderComponent` exists in index.tsx
Grep: `Recent Activity` exists in index.tsx
</verification>

<success_criteria>
- Net balance number displayed at top of home screen using moneyLarge (48px ExtraBold) typography
- Balance color-coded: green (accent) when positive, red (error) when negative, gray (textSecondary) when zero
- Balance hidden when user has no groups
- Dashboard divided into sections with visible dividers (borderSubtle)
- Activity placeholder visible with "Recent Activity" label and "Coming soon" text
- Section headers use label variant (uppercase, consistent)
- Screen header says "Home" with h2 variant
- Create group "+" button fully functional
- Pull-to-refresh, skeleton loader, invite handling all preserved
- No new API calls or libraries added
- Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-balance-summary-dashboard-layout/10-01-SUMMARY.md`
</output>
