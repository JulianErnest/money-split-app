---
phase: 12-group-cards-visual-polish
plan: 02
type: execute
wave: 2
depends_on: ["12-01"]
files_modified:
  - app/(tabs)/index.tsx
  - components/ui/Skeleton.tsx
autonomous: false

must_haves:
  truths:
    - "Balance header has a gradient background that glows green when positive, red when negative"
    - "Group cards use glassmorphism styling with semi-transparent backgrounds"
    - "Group cards show last activity date, member avatar stack, and per-group balance"
    - "Group cards have scale-down press animation via MotiPressable"
    - "Empty states use clean English copy that guides users toward action"
  artifacts:
    - path: "app/(tabs)/index.tsx"
      provides: "Polished dashboard with gradient header, glass cards, enriched group info"
      contains: "LinearGradient"
    - path: "app/(tabs)/index.tsx"
      provides: "MotiPressable group card press effect"
      contains: "MotiPressable"
  key_links:
    - from: "app/(tabs)/index.tsx"
      to: "lib/group-card-data.ts"
      via: "fetchGroupCardData import and call"
      pattern: "fetchGroupCardData"
    - from: "app/(tabs)/index.tsx"
      to: "components/ui/GlassCard.tsx"
      via: "GlassCard import in renderGroupCard"
      pattern: "GlassCard"
    - from: "app/(tabs)/index.tsx"
      to: "components/ui/AvatarStack.tsx"
      via: "AvatarStack import in renderGroupCard"
      pattern: "AvatarStack"
    - from: "app/(tabs)/index.tsx"
      to: "expo-linear-gradient"
      via: "LinearGradient wrapping BalanceSummaryHeader"
      pattern: "LinearGradient"
---

<objective>
Wire the gradient balance header, glassmorphism group cards with enriched data, MotiPressable press effects, and polished empty states into the dashboard.

Purpose: Transform the functional dashboard into a polished, branded product with warm visual personality â€” the capstone of v1.2.
Output: Updated dashboard screen with gradient header, glassmorphism group cards showing balance/activity/avatars, press animations, and clean empty states.
</objective>

<execution_context>
@/Users/julianernestcamello/.claude/get-shit-done/workflows/execute-plan.md
@/Users/julianernestcamello/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-group-cards-visual-polish/12-RESEARCH.md
@.planning/phases/12-group-cards-visual-polish/12-01-SUMMARY.md
@app/(tabs)/index.tsx
@components/ui/GlassCard.tsx
@components/ui/AvatarStack.tsx
@lib/group-card-data.ts
@theme/colors.ts
@lib/balance-utils.ts
@lib/activity.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add gradient balance header and enriched glassmorphism group cards</name>
  <files>
    app/(tabs)/index.tsx
    components/ui/Skeleton.tsx
  </files>
  <action>
This task transforms the dashboard screen in `app/(tabs)/index.tsx` with all Phase 12 visual polish. The changes are:

**1. Gradient Balance Header:**

Replace the plain `<View>` wrapper in `BalanceSummaryHeader` with `<LinearGradient>` from `expo-linear-gradient`.

```typescript
import { LinearGradient } from 'expo-linear-gradient';
```

The gradient should dynamically change based on balance direction:
- Positive balance (owed to user): green glow â€” `colors={['#0D0D0D', 'rgba(159, 232, 112, 0.12)', '#0D0D0D']}`
- Negative balance (user owes): red glow â€” `colors={['#0D0D0D', 'rgba(232, 84, 84, 0.12)', '#0D0D0D']}`
- Zero / no balance: neutral amber glow â€” `colors={['#0D0D0D', 'rgba(245, 166, 35, 0.08)', '#0D0D0D']}`

Gradient direction: `start={{ x: 0, y: 0 }}` to `end={{ x: 1, y: 1 }}` (diagonal).

Keep the existing content (Overall Balance label, moneyLarge amount, summary text) inside the gradient. Replace the `<View style={balanceSummaryStyles.container}>` with `<LinearGradient style={balanceSummaryStyles.container} ...>`.

**2. Enriched Group Cards with Glassmorphism:**

Add new imports at the top:
```typescript
import { GlassCard } from '@/components/ui/GlassCard';
import { AvatarStack } from '@/components/ui/AvatarStack';
import { GroupCardData, fetchGroupCardData } from '@/lib/group-card-data';
import { MotiPressable } from 'moti/interactions';
import { formatRelativeTime } from '@/lib/activity';
```

Add state for group card data:
```typescript
const [groupCardData, setGroupCardData] = useState<Map<string, GroupCardData>>(new Map());
```

Add fetch function for group card data (following existing fetchGroups/fetchBalances pattern):
```typescript
const fetchCardData = useCallback(async () => {
  if (!user) return;
  try {
    const data = await fetchGroupCardData();
    const map = new Map<string, GroupCardData>();
    for (const item of data) {
      map.set(item.group_id, item);
    }
    setGroupCardData(map);
  } catch {
    // Silently skip
  }
}, [user]);
```

Wire `fetchCardData` into:
- The initial `Promise.all([fetchGroups(), fetchInvites(), fetchActivities()])` â€” add it
- The `useFocusEffect` callback â€” add it
- The `handleRefresh` callback â€” add it
- The sync-complete listener â€” add it

**Replace `renderGroupCard`** to use the new card structure:

The new group card uses GlassCard instead of Card, with this layout:
```
MotiPressable (scale 0.97 on press, opacity 0.9, timing 150ms)
  GlassCard
    Row (topRow)
      Avatar (emoji, size md)
      Info column (flex: 1)
        Group name (bodyMedium, textPrimary)
        Last activity date (caption, textTertiary) -- use formatRelativeTime(cardInfo.last_activity_at) or "No activity yet"
      Balance column (right-aligned) -- only if non-zero balance
        P{amount} (bodyMedium, color-coded via formatBalanceColor)
        "owed" or "owe" descriptor (caption, textSecondary)
    AvatarStack row (below topRow, marginTop: spacing[3]) -- only if cardInfo has members
      AvatarStack members={cardInfo.members} max={4}
```

Balance descriptor logic:
- `netCentavos > 0` â†’ "owed to you"
- `netCentavos < 0` â†’ "you owe"

The MotiPressable replaces the outer Pressable. For pending (offline) groups, keep the existing simple rendering without MotiPressable (just opacity 0.6).

Remove the `memberCounts` state and its fetch logic (inside fetchGroups) â€” the new `groupCardData` provides member count. But keep `memberCounts` as a fallback for the transition period: use `cardInfo?.member_count || memberCounts[group.id] || 0` if you want, but it is cleaner to just remove the old member count query from fetchGroups entirely and rely on fetchCardData. The memberCounts state, the batch query inside fetchGroups that fetches from group_members and counts, and the `setCachedData` for group_counts â€” all can be removed.

Remove the old MotiView fade-in wrapper around group cards (the `initialLoadDone.current` check). MotiPressable provides enough animation.

Remove the chevron ">" text from group cards â€” the press animation makes it clear they are tappable.

**3. Empty States â€” English, Minimal, Action-guiding:**

Update the groups empty state (in `renderSectionFooter`) from Tagalog to English:
- Old: `emoji="ðŸ‘¥"` headline="Wala pa kay group!" subtext="Tap + to create one, or ask a friend for an invite code"
- New: `emoji="ðŸ‘¥"` headline="No groups yet" subtext="Create a group to start splitting expenses with friends"

The dashboard activity empty state already says "No recent activity" (plain text, not EmptyState component) â€” leave as-is.

**4. Updated Skeleton:**

In `components/ui/Skeleton.tsx`, update the `GroupsListSkeleton` to show glassmorphism-style skeleton cards if needed. The minimal change: replace the skeleton card background from `colors.backgroundCard` to `rgba(255, 255, 255, 0.05)` to match the new GlassCard appearance. If GroupsListSkeleton already uses Card styles internally, update just the background color reference.

**5. Style Updates:**

Update styles to support the new card layout. Add these style entries:
- `cardTopRow`: flexDirection: 'row', alignItems: 'center', gap: spacing[3]
- `cardBalanceCol`: alignItems: 'flex-end'
- `cardAvatarRow`: marginTop: spacing[3]

Remove styles that are no longer needed: `balanceText` (the balance moves from inline text to a separate column).
  </action>
  <verify>
1. `npx tsc --noEmit` â€” no new TypeScript errors (pre-existing ones acceptable)
2. The dashboard imports and uses LinearGradient, GlassCard, AvatarStack, MotiPressable
3. The BalanceSummaryHeader uses LinearGradient with dynamic colors based on balance sign
4. renderGroupCard uses GlassCard instead of Card, and includes AvatarStack and balance column
5. Empty state text is in English: "No groups yet"
  </verify>
  <done>
- Balance header wrapped in LinearGradient with dynamic green/red/amber glow
- Group cards use glassmorphism (GlassCard) with enriched info: last activity, avatar stack, balance column
- MotiPressable provides scale-down press animation on group cards
- Empty states use clean English copy guiding users toward action
- Group card data fetched via new RPC (fetchCardData wired into all fetch paths)
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify visual polish on device/simulator</name>
  <what-built>
Complete Phase 12 visual polish:
1. Gradient balance header with dynamic green/red/amber glow based on balance direction
2. Glassmorphism group cards with semi-transparent background and subtle border
3. Enriched group cards showing: last activity date, member avatar stack, per-group balance column
4. MotiPressable scale-down press effect on group cards
5. Clean English empty states guiding users toward action
6. Warm accent color palette (amber, coral) added to theme
  </what-built>
  <how-to-verify>
1. Open the app on a simulator or device
2. **Balance header:** Verify the gradient glow behind the balance area â€” should be subtle, not overwhelming. If you have a positive balance, it should have a faint green glow. If negative, faint red. If zero, neutral amber.
3. **Group cards:** Verify cards have a frosted-glass appearance (slightly lighter than the dark background with a subtle border). They should feel distinct from the background but not bright.
4. **Card press:** Long-press/tap a group card â€” it should scale down slightly (0.97) with a smooth 150ms animation. Release should snap back.
5. **Card info:** Each group card should show:
   - Group emoji + name on the left
   - Last activity date below the name (e.g., "2h ago" or "No activity yet")
   - Balance amount on the right (color-coded green/red)
   - Balance descriptor below amount ("owed to you" / "you owe")
   - Member avatar stack at the bottom of the card
6. **Empty state:** If you have a state with no groups, verify it says "No groups yet" with "Create a group to start splitting expenses with friends"
7. **Overall feel:** The dashboard should feel warmer and more polished â€” like a branded product, not a plain list
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` passes (ignoring pre-existing cosmetic errors)
2. LinearGradient wraps the balance header with dynamic color based on balance direction
3. Group cards use GlassCard (glassmorphism) instead of Card
4. Group cards display: last activity date, avatar stack, per-group balance column
5. MotiPressable provides press animation on group cards
6. Empty states are in English with action-guiding copy
7. User visually verifies the polish meets expectations
</verification>

<success_criteria>
- Balance header has visible gradient glow (green/red/amber based on balance)
- Group cards look premium with glassmorphism and enriched information
- Press animation on group cards feels smooth and tactile
- Empty states are professional English with action guidance
- Dashboard feels like a polished, branded product
</success_criteria>

<output>
After completion, create `.planning/phases/12-group-cards-visual-polish/12-02-SUMMARY.md`
</output>
